#!/usr/bin/env bash
set -Eeou pipefail

# TODO remove this script as soon as we completely move to the init database approach

source scripts/dev/set_env_context.sh
source scripts/funcs/kubernetes
source scripts/funcs/printing

title "Building Database image..."

ensure_ecr_repository "${REPO_URL}/mongodb-enterprise-database"

repo_host="$(echo "${REPO_URL}" | cut -d "/" -f 1)"
repo_name="$(echo "${REPO_URL}" | cut -d "/" -f 2)"

make -C docker/mongodb-enterprise-database push IMAGE_DIR="${repo_name}" AWS_IMAGE_REPO="${repo_host}" IMAGE_TYPE="${IMAGE_TYPE}"

title "Database image successfully built and pushed to ${REPO_URL} registry"
