# Evergreen configuration for MongoDB Cloud, Atlas and OpsManager
stepback: true

variables:
- &paths
  chrome_path: "/opt/google/chrome/chrome"
- &software_versions
  mongodb_version: "3.4.10"
  chromedriver_version: "2.35"
  nodejs_version: "8.9.3"
  mongomirror_version: "0.2.8"
- &build_versions
  ops_manager_version: "3.7.0"

functions:
  "setup": &setup
    command: git.get_project
    type: system
    params:
      directory: ops-manager-kubernetes
    script: |
      dep ensure
      ./codegen.sh
      CGO_ENABLED=0 GOOS=linux go build -o om-operator

tasks:

- name: SETUP
  tags: ["setup"]
  commands:
    - func: "setup"
      vars:
        testGroup: "nds"
        cloudProvider: "AWS"
        cucumberOptions: "--tags @tenant"

post:
  - command: shell.exec
    params:
      shell: bash
      script: |
        set -x
        JUNIT_PATH="mms/server/build/test-reports"
        if [[ -e $JUNIT_PATH/cukes.xml ]]; then
          # for all E2E tests, remove JUNIT results but leave cukes.xml
          rm $JUNIT_PATH/TEST*.xml
        fi;

buildvariants:

- name: one
  display_name: 1.
  run_on:
    - rhel70-small
  batchtime: 1440 # 1 day
  stepback: false
  expansions:
    <<: *setup
  tasks:
    - ".setup"
