# Temporary Dockerfile for rebuilding existing agent context images
# This Dockerfile uses an existing context image as base and adds the new script files
# that were recently added to the repository but may not be in older context images.

ARG OLD_CONTEXT_IMAGE
FROM ${OLD_CONTEXT_IMAGE}

# Copy the new script files that need to be added to all agents
# Use --chmod to set permissions during copy to avoid permission conflicts
COPY --chmod=755 ./docker/mongodb-agent/dummy-probe.sh /opt/scripts/dummy-probe.sh
COPY --chmod=755 ./docker/mongodb-agent/dummy-readinessprobe.sh /opt/scripts/dummy-readinessprobe.sh
COPY --chmod=755 ./docker/mongodb-agent/agent-launcher-shim.sh /opt/scripts/agent-launcher-shim.sh
COPY --chmod=755 ./docker/mongodb-agent/setup-agent-files.sh /opt/scripts/setup-agent-files.sh

# Verify files are present and executable
RUN ls -la /opt/scripts/ && \
    test -x /opt/scripts/dummy-probe.sh && \
    test -x /opt/scripts/dummy-readinessprobe.sh && \
    test -x /opt/scripts/agent-launcher-shim.sh && \
    test -x /opt/scripts/setup-agent-files.sh && \
    echo "All script files are present and executable"
