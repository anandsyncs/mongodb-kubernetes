apiVersion: mongodb.com/v1
kind: MongoDBOpsManager
metadata:
  name: om-localmode-single-pv
spec:
  replicas: 1
  version: 4.4.1
  adminCredentials: ops-manager-admin-secret
  configuration:
    mms.testUtil.enabled: "true"
    automation.versions.source: local

  statefulSet:
    spec:
      template:
        spec:
          volumes:
            - name: mongodb-versions
              persistentVolumeClaim:
                claimName: mongodb-versions-claim
          containers:
            - name: mongodb-ops-manager
              volumeMounts:
                - name: mongodb-versions
                  mountPath: /mongodb-ops-manager/mongodb-releases
          initContainers:
            - name: mongod-binaries-ubuntu-init-container
              image: quay.io/mongodb/mongodb-enterprise-init-mongod-ubuntu1604:4.2.8
              imagePullPolicy: Always
              command:
                - cp
                - -a
                - /binaries/.
                - /mongodb-ops-manager/mongodb-releases/
              volumeMounts:
                - name: mongodb-versions
                  mountPath: /mongodb-ops-manager/mongodb-releases
            - name: mongod-binaries-ubi7-init-container
              image: quay.io/mongodb/mongodb-enterprise-init-mongod-rhel80:4.2.8
              imagePullPolicy: Always
              command:
                - cp
                - -a
                - /binaries/.
                - /mongodb-ops-manager/mongodb-releases/
              volumeMounts:
                - name: mongodb-versions
                  mountPath: /mongodb-ops-manager/mongodb-releases
            - name: setting-up-rhel-mongodb-tools-100-1-0
              image: busybox:latest
              command:
                - wget
                - -O
                - /mongodb-ops-manager/mongodb-releases/mongodb-database-tools-rhel80-x86_64-100.1.0.tgz
                - https://fastdl.mongodb.org/tools/db/mongodb-database-tools-rhel80-x86_64-100.1.0.tgz
              volumeMounts:
                - name: mongodb-versions
                  mountPath: /mongodb-ops-manager/mongodb-releases
            - name: setting-up-ubuntu-mongodb-tools-100-1-0
              image: busybox:latest
              command:
                - wget
                - -O
                - /mongodb-ops-manager/mongodb-releases/mongodb-database-tools-ubuntu1604-x86_64-100.1.0.tgz
                - https://fastdl.mongodb.org/tools/db/mongodb-database-tools-ubuntu1604-x86_64-100.1.0.tgz
              volumeMounts:
                - name: mongodb-versions
                  mountPath: /mongodb-ops-manager/mongodb-releases

  backup:
    enabled: false

  applicationDatabase:
    members: 3
    persistent: true
